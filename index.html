<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gagne Jazz Fest 2026</title>
    <link href="https://fonts.googleapis.com/css2?family=Alfa+Slab+One&family=Nunito+Sans:wght@400;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html, body { overflow-x: hidden; }
        :root {
            /* New Orleans Jazz Heritage Palette */
            --jazz-red: #D84A3C;
            --burnt-orange: #C85A3C;
            --warm-orange: #E07A3C;
            --golden-orange: #F5A944;
            --warm-yellow: #F4E87C;
            --rich-brown: #5D3A29;
            --dark-charcoal: #2A2A2A;
            --off-white: #FFF8E7;
            --vintage-teal: #2DB8A8;
            
            /* Semantic colors */
            --primary: var(--jazz-red);
            --accent: var(--warm-orange);
            --highlight: var(--golden-orange);
            --success: var(--vintage-teal);
            --text: var(--off-white);
            --dark: #1A1A1A;
        }
        body {
            font-family: 'DIN', 'Helvetica Neue', 'Arial Narrow', sans-serif;
            background: 
                /* Bold diagonal gradient using full palette */
                linear-gradient(135deg, 
                    #3D2817 0%,      /* Rich brown */
                    #5D3A29 15%,     /* Brown from palette */
                    #8B4513 25%,     /* Deep rust */
                    #C85A3C 40%,     /* Burnt orange */
                    #D84A3C 55%,     /* Jazz red */
                    #E07A3C 70%,     /* Warm orange */
                    #F5A944 85%,     /* Golden orange */
                    #F4E87C 100%     /* Warm yellow */
                );
            color: var(--text);
            min-height: 100vh;
            padding: 20px;
            max-width: 1600px;
            margin: 0 auto;
            position: relative;
            overflow-x: hidden;
        }
        /* Remove the dark overlay - we want vibrant colors! */
        body::before {
            display: none;
        }
        
        /* WATERMARK YEAR - Large background element behind header */
        .year-watermark {
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            font-family: 'Arial Black', 'Impact', sans-serif;
            font-size: clamp(12rem, 30vw, 25rem);
            font-weight: 900;
            letter-spacing: 0.1em;
            color: rgba(255, 255, 255, 0.04);
            z-index: 0;
            pointer-events: none;
            user-select: none;
            line-height: 0.8;
            opacity: 1;
            animation: fadeDown 1s ease-out;
            max-width: 100%;
            overflow: hidden;
        }
        @keyframes fadeDown {
            from {
                opacity: 0;
                transform: translateX(-50%) translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(-50%) translateY(0);
            }
        }
        
        /* HEADER - No box, just floating on gradient */
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 50px 20px 30px;
            position: relative;
            z-index: 1;
            background: transparent;
        }
        .header-main-text {
            font-family: 'Arial Black', 'Impact', 'Helvetica Condensed', 'Franklin Gothic', sans-serif;
            font-size: clamp(3rem, 9vw, 7rem);
            font-weight: 900;
            letter-spacing: 0.08em;
            line-height: 0.9;
            margin: 0 0 15px 0;
            background: linear-gradient(135deg, 
                var(--warm-orange) 0%, 
                var(--golden-orange) 50%, 
                var(--warm-yellow) 100%
            );
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-transform: uppercase;
            font-stretch: condensed;
            filter: drop-shadow(0 2px 8px rgba(0, 0, 0, 0.4));
        }
        .header-subtitle {
            font-size: 0.85rem;
            font-weight: 500;
            letter-spacing: 0.12em;
            color: rgba(255, 255, 255, 0.6);
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.5);
        }
        
        .tabs {
            display: flex; gap: 10px; margin-bottom: 25px;
            justify-content: center; flex-wrap: wrap;
            position: relative;
            z-index: 1;
        }
        .tab-btn {
            background: rgba(0, 0, 0, 0.5);
            border: 2px solid var(--burnt-orange);
            color: var(--text);
            padding: 12px 28px;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            letter-spacing: 0.5px;
        }
        .tab-btn:hover {
            background: rgba(216, 74, 60, 0.2);
            border-color: var(--jazz-red);
            transform: translateY(-2px);
        }
        .tab-btn.active {
            background: var(--jazz-red);
            border-color: var(--warm-orange);
            box-shadow: 0 4px 12px rgba(216, 74, 60, 0.4);
        }
        .tab-content { display: none; }
        .tab-content.active { display: block; position: relative; z-index: 1; }
        .trip-info {
            background: rgba(212, 175, 55, 0.15); border: 2px solid var(--gold);
            border-radius: 15px; padding: 20px; margin-bottom: 25px;
            text-align: center; backdrop-filter: blur(10px);
        }
        .trip-info-row {
            display: flex; justify-content: center; gap: 30px;
            flex-wrap: wrap; font-size: 0.95rem;
        }
        .trip-info-row span { display: flex; align-items: center; gap: 6px; }
        .legend {
            background: rgba(255, 255, 255, 0.08); border: 1px solid var(--border);
            border-radius: 15px; padding: 20px; margin-bottom: 25px;
            backdrop-filter: blur(10px);
        }
        .legend h3 {
            font-size: 0.875rem; font-weight: 700; color: var(--gold);
            margin-bottom: 12px; text-transform: uppercase; letter-spacing: 1px;
        }
        .legend-items { display: flex; gap: 20px; flex-wrap: wrap; }
        .legend-item {
            display: flex; align-items: center; gap: 8px;
            font-size: 0.875rem; font-weight: 600;
        }
        .legend-badge { width: 12px; height: 12px; border-radius: 2px; }
        .legend-badge.tickets { background: var(--vintage-teal); }
        .legend-badge.planning { background: var(--golden-orange); }
        .legend-badge.maybe { background: rgba(255, 255, 255, 0.4); }
        .legend-badge.none { background: rgba(255, 255, 255, 0.3); }
        .controls {
            background: rgba(255, 255, 255, 0.08); border: 1px solid var(--border);
            border-radius: 15px; padding: 20px; margin-bottom: 25px;
            backdrop-filter: blur(10px);
        }
        .search-wrapper {
            position: relative;
            width: 100%;
            margin-bottom: 15px;
        }
        .search-bar {
            width: 100%;
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(200, 90, 60, 0.3);
            border-radius: 8px;
            padding: 12px 40px 12px 16px;
            color: var(--text);
            font-size: 1rem;
        }
        .search-bar:focus {
            outline: none;
            border-color: var(--warm-orange);
            box-shadow: 0 0 0 3px rgba(224, 122, 60, 0.2);
        }
        .search-clear {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            color: var(--text);
            font-size: 1rem;
            cursor: pointer;
            display: none;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }
        .search-clear:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        .filters { display: flex; gap: 10px; flex-wrap: wrap; }
        .filter-btn {
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(200, 90, 60, 0.3);
            color: var(--text);
            padding: 8px 16px;
            border-radius: 8px;
            font-weight: 600;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.3s ease;
            letter-spacing: 0.3px;
        }
        .filter-btn:hover {
            background: rgba(216, 74, 60, 0.2);
            border-color: var(--burnt-orange);
        }
        .filter-btn.active {
            background: var(--burnt-orange);
            color: white;
            border-color: var(--jazz-red);
        }
        .add-show-btn {
            position: fixed; bottom: 30px; right: 30px;
            background: linear-gradient(135deg, var(--golden-orange) 0%, var(--warm-orange) 100%);
            color: var(--dark);
            border: none;
            border-radius: 8px;
            padding: 16px 28px;
            font-weight: 700;
            font-size: 0.95rem;
            cursor: pointer;
            box-shadow: 
                0 8px 24px rgba(245, 169, 68, 0.6),
                0 4px 8px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            z-index: 100;
            letter-spacing: 0.5px;
        }
        .add-show-btn:hover {
            background: linear-gradient(135deg, var(--warm-orange) 0%, var(--jazz-red) 100%);
            transform: translateY(-3px);
            box-shadow: 
                0 12px 32px rgba(224, 122, 60, 0.7),
                0 6px 12px rgba(0, 0, 0, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }
        .add-activity-btn {
            position: fixed;
            bottom: 90px;
            right: 30px;
            background: linear-gradient(135deg, var(--burnt-orange) 0%, var(--jazz-red) 100%);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 16px 28px;
            font-weight: 700;
            font-size: 0.95rem;
            cursor: pointer;
            box-shadow: 
                0 8px 24px rgba(200, 90, 60, 0.6),
                0 4px 8px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.15);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            z-index: 100;
            letter-spacing: 0.5px;
        }
        .add-activity-btn:hover {
            background: var(--jazz-red);
            transform: translateY(-2px);
            box-shadow: 0 12px 32px rgba(27, 154, 170, 0.7);
        }
        .day-section, .venue-section {
            background: rgba(26, 26, 26, 0.85);
            backdrop-filter: blur(20px) saturate(180%);
            -webkit-backdrop-filter: blur(20px) saturate(180%);
            border: 1px solid rgba(255, 255, 255, 0.18);
            border-left: 4px solid var(--warm-orange);
            border-radius: 16px;
            padding: 28px;
            margin-bottom: 30px;
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.4),
                0 2px 8px rgba(0, 0, 0, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            position: relative;
        }
        /* Subtle top accent line */
        .day-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, 
                transparent, 
                rgba(245, 169, 68, 0.4) 50%, 
                transparent
            );
        }
        .venue-section {
            border-left-color: var(--burnt-orange);
        }
        .day-header, .venue-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
        }
        .day-header::after, .venue-header::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 0;
            width: 60px;
            height: 2px;
            background: var(--golden-orange);
        }
        .day-title {
            font-size: 2rem;
            font-weight: 900;
            color: var(--warm-orange);
            letter-spacing: 3px;
            text-transform: uppercase;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.6);
            position: relative;
        }
        .venue-name { font-size: 1.5rem; font-weight: 800; color: var(--teal); }
        .day-subtitle, .venue-address {
            font-size: 0.875rem; color: rgba(255, 248, 231, 0.7);
            font-weight: 600; margin-top: 2px;
        }
        .section-title {
            font-size: 1rem;
            font-weight: 700;
            color: var(--golden-orange);
            margin: 24px 0 14px 0;
            letter-spacing: 0.5px;
            padding-bottom: 8px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
        }
        .section-title::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 0;
            width: 80px;
            height: 2px;
            background: var(--golden-orange);
        }
        .section-title:first-child { margin-top: 0; }
        .cards-grid, .shows-grid {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 12px; margin-bottom: 20px;
        }
        /* Jazz Fest Library Pills */
        .jazzfest-pills {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 20px;
        }
        .show-card-jazzfest {
            display: inline-flex !important;
            align-items: center;
            border-radius: 8px;
            padding: 8px 14px;
            min-height: 36px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            background: rgba(0, 0, 0, 0.3);
        }
        .show-card-jazzfest.tier1 {
            flex: 0 1 calc(50% - 4px);
        }
        .show-card-jazzfest.tier2 {
            flex: 0 1 calc(33.33% - 5.33px);
        }
        .show-card-jazzfest.tier3 {
            flex: 0 1 calc(25% - 6px);
        }
        .show-card-jazzfest .show-header {
            width: 100%;
            margin: 0;
            padding: 0;
        }
        .show-card-jazzfest .show-name {
            font-size: 0.85rem;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        .show-card-jazzfest.tier1 .show-name {
            font-size: 1rem;
            font-weight: 700;
        }
        .show-card-jazzfest.tier2 .show-name {
            font-size: 0.9rem;
        }
        .show-card-jazzfest.tier3 .show-name {
            font-size: 0.8rem;
        }
        .show-card-jazzfest .add-btn {
            margin-left: auto;
        }
        .card {
            background: rgba(26, 26, 26, 0.75);
            backdrop-filter: blur(10px) saturate(180%);
            -webkit-backdrop-filter: blur(10px) saturate(180%);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 10px;
            padding: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            border-left: 3px solid transparent;
            box-shadow: 
                0 4px 16px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.08);
        }
        .card.size-large {
            grid-column: span 2;
            padding: 24px;
        }
        .card.size-large .card-name {
            font-size: 1.5rem;
        }
        .card.size-medium .card-name {
            font-size: 1.2rem;
        }
        .card.size-small .card-name {
            font-size: 1.05rem;
        }
        @media (max-width: 768px) {
            /* Prevent horizontal scroll on mobile */
            body {
                padding: 15px;
                overflow-x: hidden;
            }
            
            /* Optimize header for mobile */
            .header {
                padding: 40px 15px 25px;
                overflow: hidden;
            }
            .header-main-text {
                font-size: clamp(2.5rem, 12vw, 4rem);
                letter-spacing: 0.05em;
            }
            .header-subtitle {
                font-size: 0.75rem;
                letter-spacing: 0.08em;
            }
            
            /* Make watermark smaller on mobile to prevent overflow */
            .year-watermark {
                font-size: clamp(8rem, 25vw, 15rem);
                letter-spacing: 0.05em;
            }
            
            .card.size-large {
                grid-column: span 1;
            }
        }
        .show-card {
            background: rgba(26, 26, 26, 0.75);
            backdrop-filter: blur(10px) saturate(180%);
            -webkit-backdrop-filter: blur(10px) saturate(180%);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 10px;
            padding: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            border-left: 3px solid transparent;
            box-shadow: 
                0 4px 16px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.08);
        }
        .card:hover, .show-card:hover {
            background: rgba(36, 36, 36, 0.85);
            backdrop-filter: blur(15px) saturate(200%);
            -webkit-backdrop-filter: blur(15px) saturate(200%);
            border-color: var(--warm-orange);
            transform: translateX(5px);
            box-shadow: 
                0 6px 20px rgba(0, 0, 0, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.12);
        }
        .show-card:hover {
            transform: translateY(-3px);
            box-shadow: 
                0 8px 24px rgba(0, 0, 0, 0.5),
                inset 0 1px 0 rgba(255, 255, 255, 0.12);
        }
        .card.has-tickets { border-left-color: var(--vintage-teal); }
        .card.planning { border-left-color: var(--golden-orange); }
        .card.maybe { border-left-color: rgba(255, 255, 255, 0.3); }
        .show-card.in-planner {
            border-left: 4px solid var(--vintage-teal);
            background: rgba(42, 157, 47, 0.1);
        }
        .show-card.tier1 {
            grid-column: span 2;
            padding: 24px;
        }
        .show-card.tier1 .show-name {
            font-size: 1.5rem;
        }
        .show-card.tier2 .show-name {
            font-size: 1.2rem;
        }
        .show-card.tier3 .show-name {
            font-size: 1.05rem;
        }
        .card-header, .show-header {
            display: flex; justify-content: space-between;
            align-items: start; margin-bottom: 10px;
        }
        .card-name, .show-name {
            font-weight: 700; font-size: 1.1rem;
            color: var(--light); line-height: 1.3; flex: 1;
        }
        .show-name { font-size: 1.05rem; margin-right: 10px; }
        .delete-btn {
            background: none; border: none; color: rgba(255, 255, 255, 0.4);
            cursor: pointer; padding: 4px 8px; font-size: 1.2rem;
            line-height: 1; opacity: 0; transition: all 0.2s ease;
            font-weight: 700;
        }
        .card:hover .delete-btn { opacity: 1; }
        .delete-btn:hover { color: var(--orange); }
        .add-btn {
            background: rgba(255, 255, 255, 0.9);
            color: var(--dark);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            width: 36px;
            height: 36px;
            font-size: 1.4rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }
        .add-btn:hover {
            background: white;
            transform: scale(1.15);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
        }
        .add-btn.added {
            background: var(--vintage-teal);
            color: white;
            border-color: var(--vintage-teal);
        }
        .card-details, .show-details {
            font-size: 0.9rem; color: rgba(255, 248, 231, 0.8);
            display: flex; flex-direction: column; gap: 6px;
        }
        .card-detail-row, .show-detail-row {
            display: flex; align-items: center; gap: 6px;
        }
        .time-group { display: flex; flex-direction: column; gap: 3px; }
        .card-badge {
            display: inline-block; padding: 4px 10px; border-radius: 6px;
            font-size: 0.75rem; font-weight: 700; margin-top: 10px;
            text-transform: uppercase;
        }
        .card-badge.tickets { background: var(--vintage-teal); color: white; }
        .card-badge.planning { background: var(--golden-orange); color: var(--dark); }
        .card-badge.maybe { background: rgba(255, 255, 255, 0.2); color: var(--text); }
        .show-day {
            display: inline-block; background: rgba(27, 154, 170, 0.3);
            color: var(--teal); padding: 4px 10px; border-radius: 6px;
            font-size: 0.75rem; font-weight: 700;
            text-transform: uppercase; margin-top: 8px;
        }
        .card-notes, .show-notes {
            margin-top: 8px; font-size: 0.85rem;
            color: rgba(255, 248, 231, 0.7);
            font-style: italic; line-height: 1.4;
        }
        .modal {
            display: none; position: fixed; top: 0; left: 0;
            width: 100%; height: 100%; background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(8px); z-index: 1000;
            align-items: center; justify-content: center; padding: 20px;
        }
        .modal.active { display: flex; }
        .modal-content {
            background: rgba(26, 26, 26, 0.9);
            backdrop-filter: blur(20px) saturate(180%);
            -webkit-backdrop-filter: blur(20px) saturate(180%);
            border: 1px solid rgba(255, 255, 255, 0.18);
            border-radius: 20px;
            padding: 32px;
            max-width: 500px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 
                0 20px 60px rgba(0, 0, 0, 0.6),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }
        .modal-header {
            font-size: 2rem;
            font-weight: 900;
            color: var(--warm-orange);
            margin-bottom: 24px;
            letter-spacing: 1px;
        }
        .form-group { margin-bottom: 20px; }
        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: var(--golden-orange);
            font-weight: 700;
            font-size: 0.875rem;
            letter-spacing: 0.3px;
        }
        .form-group input, .form-group textarea, .form-group select {
            width: 100%;
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(200, 90, 60, 0.3);
            border-radius: 8px;
            padding: 12px;
            color: var(--text);
            font-size: 0.95rem;
            transition: all 0.2s ease;
        }
        .form-group input:focus, .form-group textarea:focus, .form-group select:focus {
            outline: none;
            border-color: var(--warm-orange);
            box-shadow: 0 0 0 3px rgba(224, 122, 60, 0.2);
        }
        .form-group select { cursor: pointer; }
        .form-group textarea { resize: vertical; min-height: 80px; }
        .btn-group { display: flex; gap: 12px; margin-top: 28px; }
        .btn {
            flex: 1;
            padding: 14px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 700;
            font-size: 0.95rem;
            cursor: pointer;
            transition: all 0.3s ease;
            letter-spacing: 0.5px;
        }
        .btn-primary {
            background: var(--golden-orange);
            color: var(--dark);
        }
        .btn-primary:hover {
            background: var(--warm-orange);
            transform: translateY(-2px);
        }
        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text);
            border: 1px solid rgba(200, 90, 60, 0.3);
        }
        .btn-secondary:hover { background: rgba(255, 255, 255, 0.2); }
        .no-results {
            text-align: center; padding: 40px;
            color: rgba(255, 248, 231, 0.6); font-size: 1.1rem;
        }
        .footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            color: rgba(26, 26, 26, 0.8);
            font-size: 0.9rem;
            font-weight: 700;
            text-shadow: 0 1px 2px rgba(255, 255, 255, 0.3);
        }
        .powered-by {
            margin-top: 8px;
            font-size: 0.75rem;
            font-weight: 900;
            letter-spacing: 3px;
            text-transform: uppercase;
            color: rgba(26, 26, 26, 0.5);
        }
        @media (max-width: 768px) {
            .add-show-btn {
                bottom: 20px; right: 20px;
                padding: 14px 22px; font-size: 0.9rem;
            }
            .add-activity-btn {
                bottom: 80px; right: 20px;
                padding: 14px 22px; font-size: 0.9rem;
            }
            
            /* Jazz Fest: Flexbox for pills */
            .cards-grid.section-fest { 
                display: flex !important;
                flex-wrap: wrap !important;
                gap: 6px !important;
                margin-bottom: 15px !important;
            }
            
            /* Other sections: Grid for info cards */
            .cards-grid.section-evening,
            .cards-grid.section-postfest,
            .cards-grid.section-latenight,
            .cards-grid.section-other {
                display: grid !important;
                grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)) !important;
                gap: 8px !important;
            }
            
            .shows-grid {
                display: grid !important;
                grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)) !important;
                gap: 8px !important;
            }
            
            /* Nighttime library cards - compact like planner info cards */
            .show-card {
                padding: 8px !important;
                border-radius: 8px !important;
            }
            .show-card .show-name {
                font-size: 0.85rem !important;
                line-height: 1.2 !important;
                margin-bottom: 4px !important;
            }
            .show-card .show-details {
                font-size: 0.72rem !important;
                gap: 2px !important;
            }
            .show-card .show-notes {
                font-size: 0.7rem !important;
                margin-top: 4px !important;
            }
            .show-card .show-day {
                font-size: 0.65rem !important;
                padding: 2px 6px !important;
                margin-top: 4px !important;
            }
            .show-card .add-btn {
                width: 28px !important;
                height: 28px !important;
                font-size: 1.1rem !important;
            }
            
            /* Jazz Fest Library Pills on mobile */
            .jazzfest-pills {
                display: flex !important;
                flex-wrap: wrap !important;
                gap: 6px !important;
            }
            .show-card-jazzfest {
                padding: 6px 10px !important;
                min-height: 28px !important;
                border-radius: 8px !important;
            }
            .show-card-jazzfest.tier1 {
                flex: 0 1 calc(50% - 3px) !important;
            }
            .show-card-jazzfest.tier2 {
                flex: 0 1 calc(33.33% - 4px) !important;
            }
            .show-card-jazzfest.tier3 {
                flex: 0 1 calc(25% - 4.5px) !important;
            }
            .show-card-jazzfest .show-name {
                font-size: 0.7rem !important;
            }
            .show-card-jazzfest.tier1 .show-name {
                font-size: 0.8rem !important;
            }
            .show-card-jazzfest.tier2 .show-name {
                font-size: 0.72rem !important;
            }
            .show-card-jazzfest.tier3 .show-name {
                font-size: 0.65rem !important;
            }
            .show-card-jazzfest .add-btn {
                width: 24px !important;
                height: 24px !important;
                font-size: 1rem !important;
            }
            
            .show-card.tier1 {
                grid-column: span 1;
            }
            .day-title { font-size: 1.4rem; }
            .venue-name { font-size: 1.2rem; }
            
            /* Compact day sections */
            .day-section, .venue-section {
                padding: 12px !important;
                margin-bottom: 12px !important;
            }
            .day-header, .venue-header {
                margin-bottom: 8px !important;
            }
            .section-title {
                font-size: 0.8rem !important;
                margin: 8px 0 6px 0 !important;
            }
            
            /* JAZZ FEST PILLS (fest section only) */
            .card.card-fest {
                position: relative !important;
                border-radius: 8px !important;
                padding: 6px 10px !important;
                border: 1.5px solid rgba(255, 255, 255, 0.25) !important;
                background: rgba(0, 0, 0, 0.35) !important;
                cursor: pointer !important;
                transition: all 0.2s ease !important;
                display: inline-flex !important;
                align-items: center !important;
                gap: 5px !important;
                min-height: 28px !important;
            }
            
            .card.card-fest:active {
                transform: scale(0.96) !important;
                background: rgba(0, 0, 0, 0.5) !important;
            }
            
            /* Pill sizes for fest */
            .card.card-fest.size-large {
                flex: 0 1 calc(50% - 3px) !important;
            }
            .card.card-fest.size-medium {
                flex: 0 1 calc(33.33% - 4px) !important;
            }
            .card.card-fest.size-small {
                flex: 0 1 calc(25% - 4.5px) !important;
            }
            
            /* Status colors for pills */
            .card.card-fest.has-tickets {
                border-color: var(--vintage-teal) !important;
                background: rgba(42, 157, 47, 0.2) !important;
            }
            .card.card-fest.planning {
                border-color: var(--orange) !important;
                background: rgba(247, 127, 0, 0.2) !important;
            }
            
            /* Hide details in pills */
            .card.card-fest .card-details,
            .card.card-fest .card-notes,
            .card.card-fest .card-badge {
                display: none !important;
            }
            
            /* Pill header */
            .card.card-fest .card-header {
                display: flex !important;
                align-items: center !important;
                width: 100% !important;
                margin: 0 !important;
                gap: 3px !important;
            }
            
            /* Pill name */
            .card.card-fest .card-name {
                font-size: 0.7rem !important;
                font-weight: 600 !important;
                line-height: 1.1 !important;
                margin: 0 !important;
                flex: 1 !important;
                overflow: hidden !important;
                text-overflow: ellipsis !important;
                white-space: nowrap !important;
            }
            
            .card.card-fest.size-large .card-name {
                font-size: 0.8rem !important;
                font-weight: 700 !important;
            }
            .card.card-fest.size-medium .card-name {
                font-size: 0.72rem !important;
            }
            .card.card-fest.size-small .card-name {
                font-size: 0.65rem !important;
            }
            
            /* Status dot for pills */
            .card.card-fest.has-tickets::before,
            .card.card-fest.planning::before {
                content: '' !important;
                width: 5px !important;
                height: 5px !important;
                border-radius: 50% !important;
                flex-shrink: 0 !important;
            }
            .card.card-fest.has-tickets::before {
                background: var(--vintage-teal) !important;
            }
            .card.card-fest.planning::before {
                background: var(--orange) !important;
            }
            
            /* OTHER SECTIONS: Compact info cards */
            .card.card-evening,
            .card.card-postfest,
            .card.card-latenight,
            .card.card-other {
                padding: 8px !important;
                border-radius: 8px !important;
            }
            
            .card.card-evening .card-name,
            .card.card-postfest .card-name,
            .card.card-latenight .card-name,
            .card.card-other .card-name {
                font-size: 0.85rem !important;
                line-height: 1.2 !important;
                margin-bottom: 4px !important;
            }
            
            .card.card-evening .card-details,
            .card.card-postfest .card-details,
            .card.card-latenight .card-details,
            .card.card-other .card-details {
                font-size: 0.72rem !important;
                gap: 2px !important;
            }
            
            .card.card-evening .card-notes,
            .card.card-postfest .card-notes,
            .card.card-latenight .card-notes,
            .card.card-other .card-notes {
                font-size: 0.7rem !important;
                margin-top: 4px !important;
                line-height: 1.3 !important;
            }
            
            .card.card-evening .card-badge,
            .card.card-postfest .card-badge,
            .card.card-latenight .card-badge,
            .card.card-other .card-badge {
                font-size: 0.65rem !important;
                padding: 2px 6px !important;
                margin-top: 4px !important;
            }
            
            /* Delete button */
            .delete-btn {
                display: none !important;
                font-size: 0.8rem !important;
                padding: 0 !important;
                opacity: 1 !important;
                background: rgba(255, 255, 255, 0.15) !important;
                border-radius: 50% !important;
                width: 16px !important;
                height: 16px !important;
                line-height: 16px !important;
                text-align: center !important;
                flex-shrink: 0 !important;
            }
            .card:active .delete-btn {
                display: flex !important;
                align-items: center !important;
                justify-content: center !important;
            }
        }
    </style>
</head>
<body>
    <!-- Large watermark year in background -->
    <div class="year-watermark">2026</div>
    
    <div class="header">
        <h1 class="header-main-text">GAGNE JAZZ FEST</h1>
        <div class="header-subtitle">New Orleans Jazz & Heritage Festival ¬∑ April 29 - May 5</div>
    </div>

    <div class="tabs">
        <button class="tab-btn active" onclick="switchTab('planner')">Your Planner</button>
        <button class="tab-btn" onclick="switchTab('nighttime')">Fest by Night Library</button>
        <button class="tab-btn" onclick="switchTab('jazzfest')">Jazz Fest Library</button>
    </div>

    <div id="planner-tab" class="tab-content active">
        <div class="trip-info">
            <div class="trip-info-row">
                <span>April 29 - May 5</span>
                <span>üè® Hotel Provincial</span>
                <span>Festival: Apr 30 - May 3</span>
            </div>
        </div>
        <div class="legend">
            <h3>Legend</h3>
            <div class="legend-items">
                <div class="legend-item"><div class="legend-badge tickets"></div><span>Have Tickets</span></div>
                <div class="legend-item"><div class="legend-badge planning"></div><span>Planning to Go</span></div>
                <div class="legend-item"><div class="legend-badge maybe"></div><span>Maybe</span></div>
                <div class="legend-item"><div class="legend-badge none"></div><span>No Tickets Yet</span></div>
            </div>
        </div>
        <div id="schedule-container"></div>
        <button class="add-activity-btn" onclick="openAddActivityModal()">Add Activity</button>
        <button class="add-show-btn" onclick="openAddModal()">+ Add Show</button>
    </div>

    <div id="nighttime-tab" class="tab-content">
        <div class="controls">
            <div class="search-wrapper">
                <input type="text" id="nighttime-search" class="search-bar" placeholder="Search by artist, venue, or description...">
                <button class="search-clear" id="nighttime-search-clear">‚úï</button>
            </div>
            <div class="filters" id="nighttime-filters"></div>
        </div>
        <div id="nighttime-container"></div>
    </div>

    <div id="jazzfest-tab" class="tab-content">
        <div class="controls">
            <div class="search-wrapper">
                <input type="text" id="jazzfest-search" class="search-bar" placeholder="Search by artist name...">
                <button class="search-clear" id="jazzfest-search-clear">‚úï</button>
            </div>
            <div class="filters" id="jazzfest-filters"></div>
        </div>
        <div id="jazzfest-container"></div>
    </div>

    <div class="modal" id="edit-modal">
        <div class="modal-content">
            <div class="modal-header" id="modal-title">Edit Event</div>
            <div class="form-group"><label>Section</label>
                <select id="edit-section">
                    <option value="fest">Jazz Fest Highlights</option>
                    <option value="evening">Evening Shows</option>
                    <option value="postfest">Post-Fest Shows</option>
                    <option value="latenight">Late Night Shows</option>
                    <option value="other">Other (Restaurant/Activity)</option>
                </select>
            </div>
            <div class="form-group"><label>Name</label><input type="text" id="edit-name" placeholder="e.g., Wilco"></div>
            <div class="form-group"><label>Day</label>
                <select id="edit-day">
                    <option value="wednesday">Wednesday, April 29</option>
                    <option value="thursday">Thursday, April 30</option>
                    <option value="friday">Friday, May 1</option>
                    <option value="saturday">Saturday, May 2</option>
                    <option value="sunday">Sunday, May 3</option>
                </select>
            </div>
            <div class="form-group"><label>Location/Venue</label><input type="text" id="edit-venue" placeholder="e.g., Saenger Theatre"></div>
            <div class="form-group"><label>Door Time</label><input type="text" id="edit-door-time" placeholder="e.g., 8:00pm (optional)"></div>
            <div class="form-group"><label>Show Time</label><input type="text" id="edit-show-time" placeholder="e.g., 9:00pm"></div>
            <div class="form-group"><label>Ticket Status</label>
                <select id="edit-ticket-status">
                    <option value="none">No tickets yet</option>
                    <option value="tickets">Have tickets</option>
                    <option value="planning">Planning to go</option>
                    <option value="maybe">Maybe</option>
                </select>
            </div>
            <div class="form-group"><label>Card Size</label>
                <select id="edit-card-size">
                    <option value="small">Small</option>
                    <option value="medium">Medium</option>
                    <option value="large">Large</option>
                </select>
            </div>
            <div class="form-group"><label>Notes</label><textarea id="edit-notes" placeholder="Add any notes, lineup details, or reminders..."></textarea></div>
            <div class="btn-group">
                <button class="btn btn-primary" onclick="saveEvent()">Save</button>
                <button class="btn btn-secondary" onclick="closeModal()">Cancel</button>
            </div>
        </div>
    </div>

    <div class="modal" id="add-from-library-modal">
        <div class="modal-content">
            <div class="modal-header">Add to Planner</div>
            <div class="form-group"><label>Which day?</label>
                <select id="library-day">
                    <option value="wednesday">Wednesday, April 29</option>
                    <option value="thursday">Thursday, April 30</option>
                    <option value="friday">Friday, May 1</option>
                    <option value="saturday">Saturday, May 2</option>
                    <option value="sunday">Sunday, May 3</option>
                </select>
            </div>
            <div class="form-group"><label>Which section?</label>
                <select id="library-section">
                    <option value="fest">Jazz Fest Highlights</option>
                    <option value="evening">Evening Shows</option>
                    <option value="postfest">Post-Fest Shows</option>
                    <option value="latenight">Late Night Shows</option>
                    <option value="other">Other Activities</option>
                </select>
            </div>
            <div class="btn-group">
                <button class="btn btn-primary" onclick="confirmLibraryAdd()">Add Show</button>
                <button class="btn btn-secondary" onclick="closeLibraryModal()">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Custom Confirmation Modal -->
    <div class="modal" id="confirm-modal">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header" id="confirm-title">Confirm</div>
            <div class="form-group">
                <p id="confirm-message" style="color: var(--text); line-height: 1.6; margin: 0;"></p>
            </div>
            <div class="button-group">
                <button class="btn btn-primary" id="confirm-yes">Yes</button>
                <button class="btn btn-secondary" id="confirm-no">No</button>
            </div>
        </div>
    </div>

    <div class="footer">
        Let the good times roll!
        <div class="powered-by">POWERED BY ARCHIVE</div>
    </div>

    <script>
// ============================================
// FIREBASE CONFIGURATION & INITIALIZATION
// ============================================

// Firebase config
const firebaseConfig = {
    apiKey: "AIzaSyBGsRatateNYi4omyFJQVsizhQjI_IH4qY",
    authDomain: "jazz-fest-archive.firebaseapp.com",
    projectId: "jazz-fest-archive",
    storageBucket: "jazz-fest-archive.firebasestorage.app",
    messagingSenderId: "11586231017",
    appId: "1:11586231017:web:8436ce0cb0d66b6ab16e78",
    measurementId: "G-G82P47DM3Y"
};

// Initialize Firebase
let db = null;
let plannerId = null;
let unsubscribe = null;

try {
    firebase.initializeApp(firebaseConfig);
    db = firebase.firestore();
    console.log('Firebase initialized successfully');
} catch (error) {
    console.warn('Firebase initialization failed, falling back to localStorage:', error);
}

// Get or create planner ID from URL
function getPlannerId() {
    const urlParams = new URLSearchParams(window.location.search);
    let id = urlParams.get('planner');
    
    if (!id) {
        // Generate new planner ID if none exists
        id = 'planner-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9);
        // Update URL without reload
        const newUrl = window.location.pathname + '?planner=' + id;
        window.history.replaceState({}, '', newUrl);
    }
    
    return id;
}

plannerId = getPlannerId();

// Save data to Firebase
async function saveToFirebase(data) {
    if (!db || !plannerId) {
        console.log('Firebase not available, using localStorage');
        localStorage.setItem('gagne-jazz-fest-2026-v3', JSON.stringify(data));
        return;
    }
    
    try {
        await db.collection('planners').doc(plannerId).set({
            scheduleData: data,
            lastUpdated: firebase.firestore.FieldValue.serverTimestamp()
        });
        console.log('Saved to Firebase:', plannerId);
    } catch (error) {
        console.error('Firebase save error:', error);
        // Fallback to localStorage
        localStorage.setItem('gagne-jazz-fest-2026-v3', JSON.stringify(data));
    }
}

// Load data from Firebase
async function loadFromFirebase() {
    if (!db || !plannerId) {
        console.log('Firebase not available, using localStorage');
        const saved = localStorage.getItem('gagne-jazz-fest-2026-v3');
        return saved ? JSON.parse(saved) : null;
    }
    
    try {
        const doc = await db.collection('planners').doc(plannerId).get();
        if (doc.exists) {
            console.log('Loaded from Firebase:', plannerId);
            return doc.data().scheduleData;
        }
        return null;
    } catch (error) {
        console.error('Firebase load error:', error);
        // Fallback to localStorage
        const saved = localStorage.getItem('gagne-jazz-fest-2026-v3');
        return saved ? JSON.parse(saved) : null;
    }
}

// Subscribe to real-time updates
function subscribeToUpdates(callback) {
    if (!db || !plannerId) return;
    
    unsubscribe = db.collection('planners').doc(plannerId)
        .onSnapshot((doc) => {
            if (doc.exists) {
                console.log('Real-time update received');
                callback(doc.data().scheduleData);
            }
        }, (error) => {
            console.error('Real-time subscription error:', error);
        });
}

// ============================================
// DEFAULT SCHEDULE DATA
// ============================================

// Default schedule data
function getDefaultScheduleData() {
    return {
        wednesday: {
            day: "Wednesday, April 29", subtitle: "Daze Between",
            events: {
                evening: [
                    { id: 'wed-1', name: "Grahame Lesh & Friends", venue: "The Joy Theatre", doorTime: "", showTime: "7:30pm", ticketStatus: "tickets", cardSize: "medium", notes: "ft. Ivan Neville, Jake Brownstein, Cory Henry" },
                    { id: 'wed-2', name: "Daze Between Band", venue: "Tipitina's", doorTime: "", showTime: "10:00pm", ticketStatus: "none", cardSize: "medium", notes: "Eric Krasno, George Porter Jr., Ivan Neville, Oteil Burbridge, Cory Henry, Tony Hall, Raymond Weber, Eric Bloom, Kanika Moore, Ryan Zoidis" }
                ], postfest: [], latenight: [], other: []
            }
        },
        thursday: {
            day: "Thursday, April 30", subtitle: "Locals Thursday",
            events: {
                fest: [
                    { id: 'thu-f1', name: "Widespread Panic", venue: "Fair Grounds", doorTime: "", showTime: "", ticketStatus: "none", cardSize: "medium", notes: "" },
                    { id: 'thu-f2', name: "Lake Street Dive", venue: "Fair Grounds", doorTime: "", showTime: "", ticketStatus: "none", cardSize: "medium", notes: "" },
                    { id: 'thu-f3', name: "Lettuce", venue: "Fair Grounds", doorTime: "", showTime: "", ticketStatus: "none", cardSize: "medium", notes: "" }
                ],
                postfest: [{ id: 'thu-1', name: "Wilco", venue: "Saenger Theatre", doorTime: "", showTime: "9:00pm", ticketStatus: "tickets", cardSize: "medium", notes: "'An Evening With Wilco' - two full sets" }],
                latenight: [{ id: 'thu-2', name: "Magoo", venue: "Chickie Wah Wah", doorTime: "12:30am", showTime: "1:00am", ticketStatus: "tickets", cardSize: "medium", notes: "" }],
                other: []
            }
        },
        friday: {
            day: "Friday, May 1", subtitle: "",
            events: {
                fest: [
                    { id: 'fri-f1', name: "The Black Keys", venue: "Fair Grounds", doorTime: "", showTime: "", ticketStatus: "none", cardSize: "medium", notes: "" },
                    { id: 'fri-f2', name: "Ziggy Marley", venue: "Fair Grounds", doorTime: "", showTime: "", ticketStatus: "none", cardSize: "medium", notes: "" },
                    { id: 'fri-f3', name: "Rickie Lee Jones", venue: "Fair Grounds", doorTime: "", showTime: "", ticketStatus: "none", cardSize: "medium", notes: "" },
                    { id: 'fri-f4', name: "Lainey Wilson", venue: "Fair Grounds", doorTime: "", showTime: "", ticketStatus: "none", cardSize: "medium", notes: "" },
                    { id: 'fri-f5', name: "California Honeydrops", venue: "Fair Grounds", doorTime: "", showTime: "", ticketStatus: "none", cardSize: "medium", notes: "" }
                ],
                postfest: [{ id: 'fri-1', name: "Wilco", venue: "Saenger Theatre", doorTime: "", showTime: "9:00pm", ticketStatus: "tickets", cardSize: "medium", notes: "'An Evening With Wilco' - two full sets" }],
                latenight: [],
                other: []
            }
        },
        saturday: {
            day: "Saturday, May 2", subtitle: "",
            events: {
                fest: [
                    { id: 'sat-f1', name: "Eagles", venue: "Fair Grounds", doorTime: "", showTime: "", ticketStatus: "none", cardSize: "medium", notes: "" },
                    { id: 'sat-f2', name: "Alabama Shakes", venue: "Fair Grounds", doorTime: "", showTime: "", ticketStatus: "none", cardSize: "medium", notes: "" },
                    { id: 'sat-f3', name: "T-Pain", venue: "Fair Grounds", doorTime: "", showTime: "", ticketStatus: "none", cardSize: "medium", notes: "" },
                    { id: 'sat-f4', name: "Dianne Reeves", venue: "Fair Grounds", doorTime: "", showTime: "", ticketStatus: "none", cardSize: "medium", notes: "" },
                    { id: 'sat-f5', name: "Dumpstaphunk", venue: "Fair Grounds", doorTime: "", showTime: "", ticketStatus: "none", cardSize: "medium", notes: "" },
                    { id: 'sat-f6', name: "Little Feat", venue: "Fair Grounds", doorTime: "", showTime: "", ticketStatus: "none", cardSize: "medium", notes: "" },
                    { id: 'sat-f7', name: "Sierra Hull", venue: "Fair Grounds", doorTime: "", showTime: "", ticketStatus: "none", cardSize: "medium", notes: "" }
                ],
                postfest: [
                    { id: 'sat-1', name: "Anders Osborne Birthday Bash", venue: "Civic Theatre", doorTime: "8:00pm", showTime: "9:00pm", ticketStatus: "none", cardSize: "medium", notes: "With Dave Malone, Jackie Greene, Lindsay Lou, Rebirth Brass Band" },
                    { id: 'sat-2', name: "Joe Russo's Almost Dead (JRAD)", venue: "Fillmore New Orleans", doorTime: "8:00pm", showTime: "9:00pm", ticketStatus: "none", cardSize: "medium", notes: "One night only. Joe Russo, Marco Benevento, Dave Dreiwitz, Tom Hamilton, Scott Metzger" },
                    { id: 'sat-3', name: "The Marcus King Band", venue: "Orpheum Theatre (129 Roosevelt Way)", doorTime: "", showTime: "9:00pm", ticketStatus: "tickets", cardSize: "medium", notes: "Waltz Across Texas" }
                ],
                latenight: [],
                other: []
            }
        },
        sunday: {
            day: "Sunday, May 3", subtitle: "",
            events: {
                fest: [
                    { id: 'sun-f1', name: "Tedeschi Trucks Band", venue: "Fair Grounds", doorTime: "", showTime: "", ticketStatus: "none", cardSize: "medium", notes: "" },
                    { id: 'sun-f2', name: "Teddy Swims", venue: "Fair Grounds", doorTime: "", showTime: "", ticketStatus: "none", cardSize: "medium", notes: "" },
                    { id: 'sun-f3', name: "Earth, Wind & Fire", venue: "Fair Grounds", doorTime: "", showTime: "", ticketStatus: "none", cardSize: "medium", notes: "" },
                    { id: 'sun-f4', name: "Herbie Hancock", venue: "Fair Grounds", doorTime: "", showTime: "", ticketStatus: "none", cardSize: "medium", notes: "" },
                    { id: 'sun-f5', name: "Trombone Shorty & Orleans Avenue", venue: "Fair Grounds", doorTime: "", showTime: "", ticketStatus: "none", cardSize: "medium", notes: "" },
                    { id: 'sun-f6', name: "Rebirth Brass Band", venue: "Fair Grounds", doorTime: "", showTime: "", ticketStatus: "none", cardSize: "medium", notes: "" }
                ],
                postfest: [], latenight: [], other: []
            }
        }
    };
}

const nighttimeLibrary = {
    "Saenger Theatre": { address: "111 Canal St.", shows: [
        { name: "Wilco", day: "thursday", doorTime: "", showTime: "9:00pm", notes: "Tickets from $60" },
        { name: "Wilco", day: "friday", doorTime: "", showTime: "9:00pm", notes: "Tickets from $60" },
        { name: "The Meters", day: "saturday", doorTime: "", showTime: "8:00pm", notes: "SOLD OUT" }
    ]},
    "Fillmore New Orleans": { address: "6 Canal St.", shows: [
        { name: "Karl Denson's Tiny Universe", day: "thursday", doorTime: "7:00pm", showTime: "8:00pm", notes: "Jimmy Cliff Celebration w/ Bernard Fowler & La Lom. Tickets from $51" },
        { name: "Joe Russo's Almost Dead (JRAD)", day: "saturday", doorTime: "8:00pm", showTime: "9:00pm", notes: "Tickets from $81" },
        { name: "Ari Lennox", day: "sunday", doorTime: "8:00pm", showTime: "9:00pm", notes: "Tickets from $75" }
    ]},
    "Orpheum Theatre": { address: "129 Roosevelt Way", shows: [
        { name: "Warren Haynes - Dreams & Songs", day: "thursday", doorTime: "8:00pm", showTime: "9:00pm", notes: "Symphonic Experience with Louisiana Philharmonic" },
        { name: "Gov't Mule - Jazz AfterDark", day: "friday", doorTime: "", showTime: "9:00pm", notes: "" },
        { name: "The Marcus King Band", day: "saturday", doorTime: "", showTime: "9:00pm", notes: "Waltz Across Texas" }
    ]},
    "The Joy Theater": { address: "1200 Canal St", shows: [
        { name: "Lettuce - RAGE!FEST", day: "thursday", doorTime: "9:00pm", showTime: "10:00pm", notes: "Tickets from $59" },
        { name: "The Heavyweights", day: "friday", doorTime: "8:00pm", showTime: "9:00pm", notes: "Cory Henry, Eric Krasno, Robert Sput Searight w/ Oteil Burbridge. Tickets from $53" }
    ]},
    "Civic Theatre": { address: "510 O'Keefe Ave.", shows: [
        { name: "Daniel Donato's Cosmic NOLA", day: "thursday", doorTime: "9:00pm", showTime: "10:00pm", notes: "w/ George Porter Jr., Al Schnier, Kanika Moore. Tickets from $48" },
        { name: "Anders Osborne's NOLA Birthday Bash", day: "saturday", doorTime: "8:00pm", showTime: "9:00pm", notes: "w/ Rebirth Brass Band, Dave Malone, Jackie Greene, Lindsay Lou. Tickets from $55" }
    ]},
    "Tipitina's": { address: "501 Napoleon Avenue", shows: [
        { name: "The Iceman Special", day: "thursday", doorTime: "1:00am", showTime: "2:00am", notes: "Tickets $34" },
        { name: "Galactic", day: "friday", doorTime: "8:00pm", showTime: "9:00pm", notes: "Tickets $70" },
        { name: "Neal Francis (Late Night)", day: "friday", doorTime: "1:00am", showTime: "2:00am", notes: "Tickets $58" },
        { name: "Neal Francis (Evening)", day: "saturday", doorTime: "8:00pm", showTime: "9:00pm", notes: "w/ The Breaks. Tickets $58" },
        { name: "FiyaPowa", day: "saturday", doorTime: "1:00am", showTime: "2:00am", notes: "Tickets $42" },
        { name: "Dumpstaphunk", day: "sunday", doorTime: "8:00pm", showTime: "9:00pm", notes: "Tickets $47" }
    ]},
    "Chickie Wah Wah": { address: "2828 Canal Street", shows: [
        { name: "Jon Cleary and the Absolute Monster Gentlemen", day: "thursday", doorTime: "7:00pm", showTime: "8:00pm", notes: "Tickets from $45" },
        { name: "Magoo", day: "thursday", doorTime: "12:30am", showTime: "1:00am", notes: "Late Thursday/Early Friday. Tickets $27" },
        { name: "Dan Penn & Spooner Oldham", day: "friday", doorTime: "7:00pm", showTime: "8:00pm", notes: "Tickets from $57" },
        { name: "Shantytown Underground", day: "friday", doorTime: "12:30am", showTime: "1:00am", notes: "w/ special guests. Tickets $32" },
        { name: "Terence Blanchard", day: "saturday", doorTime: "7:00pm", showTime: "8:00pm", notes: "w/ special guests. Tickets from $64" },
        { name: "Durand Jones & Friends", day: "saturday", doorTime: "10:00pm", showTime: "10:30pm", notes: "Tickets from $54" },
        { name: "Papa Mali's Birthday Bash", day: "sunday", doorTime: "10:00pm", showTime: "10:30pm", notes: "w/ Wally Ingram - Music of David Lindley. Tickets $45" }
    ]},
    "Republic New Orleans": { address: "828 South Peters St.", shows: [
        { name: "Dead Feat", day: "thursday", doorTime: "9:00pm", showTime: "10:00pm", notes: "Anders Osborne, Fred Tackett, Jackie Greene & more. Tickets $63" },
        { name: "Earth Wind & Power", day: "friday", doorTime: "9:00pm", showTime: "10:00pm", notes: "The Nth Power w/ Mark Lettieri, Skerik, Kanika Moore & more. Tickets $59" },
        { name: "STEELY DANth", day: "saturday", doorTime: "9:00pm", showTime: "10:00pm", notes: "The Nth Power w/ Cory Henry, Mark Lettieri, Peter Levin & more. Tickets $49" }
    ]},
    "Cafe Istanbul": { address: "2372 St. Claude Ave", shows: [
        { name: "Wil Blades & Friends", day: "thursday", doorTime: "8:30pm", showTime: "9:00pm", notes: "w/ Donald Harrison Jr., Otis McDonald, Bill Summers. Tickets $40-$50" },
        { name: "Melvin Seals & JGB", day: "friday", doorTime: "9:00pm", showTime: "9:30pm", notes: "w/ John Kadlecik, special guest Donald Harrison. Tickets from $65" },
        { name: "Melvin Seals & JGB", day: "saturday", doorTime: "8:30pm", showTime: "9:00pm", notes: "w/ special guest Robert Randolph. Tickets from $65" },
        { name: "Pimps of Joytime", day: "saturday", doorTime: "1:00am", showTime: "1:30am", notes: "Late night show. Tickets from $40" },
        { name: "GARAJ MAHAL", day: "sunday", doorTime: "8:30pm", showTime: "9:00pm", notes: "Kai Eckhardt, Fareed Haque, Greg Fundis. Tickets $40-$50" },
        { name: "Fareed Haque Trio", day: "sunday", doorTime: "11:30pm", showTime: "12:00am", notes: "w/ Herlin Riley, Mark Brooks. Tickets $40-$50" }
    ]},
    "House of Blues": { address: "225 Decatur Street", shows: [
        { name: "Robert Cray Band", day: "friday", doorTime: "8:00pm", showTime: "9:00pm", notes: "Tickets from $36" },
        { name: "Gramatik", day: "saturday", doorTime: "8:00pm", showTime: "9:00pm", notes: "Tickets from $42" }
    ]},
    "Rock 'n' Bowl": { address: "3000 S. Carrollton Ave", shows: [
        { name: "Sonny Landreth", day: "friday", doorTime: "", showTime: "8:30pm", notes: "w/ Dale Gaspard. Tickets $30" },
        { name: "Cowboy Mouth", day: "saturday", doorTime: "", showTime: "8:30pm", notes: "w/ Few Blue. Tickets $30" }
    ]},
    "New Orleans Jazz & Blues Market": { address: "1436 Oretha Castle Haley Blvd", shows: [
        { name: "Sue Foley", day: "thursday", doorTime: "", showTime: "7:30pm", notes: "Tickets from $36" },
        { name: "Scott Sharrard's Endless Road Live", day: "friday", doorTime: "6:00pm", showTime: "8:00pm", notes: "Tickets from $41" },
        { name: "Kenny Garrett (Early)", day: "saturday", doorTime: "", showTime: "7:00pm", notes: "Tickets from $25" },
        { name: "Kenny Garrett (Late)", day: "saturday", doorTime: "", showTime: "9:30pm", notes: "Tickets from $25" }
    ]},
    "The Broadside": { address: "600 North Broad St", shows: [
        { name: "24th Annual Bayou Rendezvous", day: "friday", doorTime: "", showTime: "", notes: "Satisfied Productions Presents" },
        { name: "Stanton Moore's Festival Finale", day: "sunday", doorTime: "", showTime: "9:00pm", notes: "Stanton Moore Trio + Frequinauts. Tickets $43-$53" }
    ]},
    "Howlin' Wolf": { address: "907 S. Peters Street", shows: [
        { name: "Hot 8 Brass Band", day: "sunday", doorTime: "", showTime: "10:30pm", notes: "Grammy Winning. Tickets $25" }
    ]},
    "Howlin' Wolf - The Den": { address: "907 S. Peters Street", shows: [
        { name: "Marvelous Funkshun", day: "thursday", doorTime: "9:00pm", showTime: "10:00pm", notes: "w/ Jon Gross, Joe Marcinek, Rebekah Todd. Tickets $13-$19" }
    ]},
    "Marigny Opera House": { address: "725 Saint Ferdinand St", shows: [
        { name: "Maggie Koerner & friends", day: "friday", doorTime: "", showTime: "7:30pm", notes: "Tickets from $44" }
    ]},
    "Bacchanal": { address: "600 Poland Avenue", shows: [
        { name: "Willie Green", day: "friday", doorTime: "", showTime: "7:00pm", notes: "" }
    ]},
    "Gasa Gasa": { address: "4920 Freret Street", shows: [
        { name: "Coma Cinema", day: "thursday", doorTime: "8:00pm", showTime: "9:00pm", notes: "w/ Trace Mountains. Tickets $22" }
    ]},
    "Santos Bar": { address: "1135 Decatur Street", shows: [
        { name: "PAST SELF", day: "saturday", doorTime: "9:00pm", showTime: "10:00pm", notes: "w/ Missing and Delores Galore. Tickets $21" }
    ]},
    "Siberia": { address: "2227 St. Claude Ave", shows: [
        { name: "Rotary Downs & Big Light", day: "friday", doorTime: "8:30pm", showTime: "9:00pm", notes: "Tickets $12" }
    ]},
    "The Spotted Cat": { address: "623 Frenchmen Street", shows: [
        { name: "Chris Christy Band", day: "thursday", doorTime: "", showTime: "2:00pm", notes: "" },
        { name: "Jumbo Shrimp Jazz Band", day: "thursday", doorTime: "", showTime: "10:00pm", notes: "" },
        { name: "Paradise Jazz Band", day: "friday", doorTime: "", showTime: "2:00pm", notes: "" },
        { name: "New Orleans Cottonmouth Kings", day: "friday", doorTime: "", showTime: "6:00pm", notes: "" },
        { name: "James Martin Band", day: "friday", doorTime: "", showTime: "10:00pm", notes: "" },
        { name: "Jacky Blaire & The Hot Biscuits", day: "sunday", doorTime: "", showTime: "2:00pm", notes: "" },
        { name: "Treme Brass Band", day: "sunday", doorTime: "", showTime: "6:00pm", notes: "" },
        { name: "Pat Casey & The New Sound", day: "sunday", doorTime: "", showTime: "9:00pm", notes: "" }
    ]},
    "Buffa's Bar & Restaurant": { address: "1001 Esplanade Avenue", shows: [
        { name: "Some Like It Hot", day: "sunday", doorTime: "", showTime: "11:00am", notes: "Traditional Jazz Brunch" }
    ]}
};

const jazzFestLibrary = {
    "Thursday, April 30": {
        tier1: ["Widespread Panic", "Lake Street Dive", "Leela James"],
        tier2: ["Lettuce", "Alejandro Escovedo", "Fred Wesley and his New JBs", "Grace Bowers"],
        tier3: ["Sweet Crude", "Buckwheat Zydeco Jr.", "Zigaboo Modeliste Funk Revue", "Jourdan Thibodeaux et Les R√¥dailleurs", 
                "Judith Owen & The Callers", "Mike Zito Band", "Tonya Boyd-Cannon", "Terrance Simien & the Zydeco Experience", 
                "Batiste Brothers Band", "Isaiah Collier", "The Tropicales", "Charmaine Neville", "Jesse Royal", "The Rising Suns", 
                "Kaya Jonkunnu Band", "Walking Tall Jamaica", "Higher Heights Reggae", "The Iguanas", "Hans Williams", "John Papa Gros", 
                "The Iceman Special", "Flagboy Giz", "Frank Waln", "Paul Porter and The Christianaires", "Anna Moss", "New Breed Brass Band", 
                "Cedric Watson et Bijou Cr√©ole", "Clive Wilson's New Orleans Serenaders", "Grayson Capps", "Johnny Sansone", 
                "Pat Casey and the New Sound", "Soul Brass Band", "Ricky Sebastian", "Steve Masakowski Family & Friends", 
                "Hot Club of New Orleans", "Ingrid Lucia", "The Palmetto Bug Stompers", "Ambush Reggae Band", "White Eagle Singers", 
                "Sons of Jazz Brass Band", "The New Orleans Rug Cutters", "Forgotten Souls", "Sasha Masakowski", "Micah McKee", 
                "Helen Gillet", "James Linden Hogg", "Ryan Brunet and the Malfecteurs", "Steve Austin & The Bioniq Brass Band"]
    },
    "Friday, May 1": {
        tier1: ["Lainey Wilson", "The Black Keys", "Ziggy Marley"],
        tier2: ["Rickie Lee Jones", "Dragon Smoke", "Marc Broussard", "Original Koffee"],
        tier3: ["Terence Blanchard + Ravi Coltrane", "The California Honeydrops", "BeauSoleil avec Michael Doucet", "Tab Benoit", 
                "Jekalyn Carr", "Bonerama", "Hot 8 Brass Band", "Cha Wa", "Charlie Gabriel and Friends", "John Foster", 
                "Runkus & Royal Blu", "The Skatalites", "The Rising Suns", "Kaya Jonkunnu Band", "Walking Tall Jamaica", 
                "Bruce Daigrepoint Cajun Band", "Amanda Shaw and The Cute Guys", "Sue Foley", "Sunpie ak Vodou Blues Ayiti", 
                "Gal Holiday & The Honky Tonk Revue", "D.K. Harrell Band", "Geno Delafose & French Rockin' Boogie", 
                "Tony Hall & The New Orleans Soul Stars", "Gerald French & The Original Tuxedo Jazz Band", "Big Chief Juan & Jockimo's Groove", 
                "Meschiya Lake and the Little Big Horns", "Debbie Davis and Friends", "Kevin Sonny Gullage & Blues Groovers", 
                "Victor Campbell", "Larry Sieberth presents Da Groove", "Andrew Jobin and the Thick Smoke", "Corey Ledet Zydeco", 
                "Baby Boyz Brass Band", "Los Guiros", "Pocket Chocolate", "Tyron Benoit Band", "Panorama Jazz Band", "Sarah Quintana", 
                "Mu√©velo", "Big Chief Kevin Goodman & the Flaming Arrows"]
    },
    "Saturday, May 2": {
        tier1: ["Eagles", "Alabama Shakes", "T-Pain"],
        tier2: ["Dianne Reeves", "Big Freedia", "Dumpstaphunk", "Little Feat", "Sierra Hull"],
        tier3: ["Larry McCray", "The Soul Rebels", "Anders Osborne", "The Gospel Soul of Irma Thomas", "Corey Henry & The Treme Funktet", 
                "Leo Nocentelli of The Meters", "C.J. Chenier & the Red Hot Louisiana Band", "Leyla McCalla", "Wayne Toups", "Dee-1", 
                "Delfeayo Marsalis & The Uptown Jazz Orchestra", "Eric Lindell", "The Skatalites", "Yaadcore", "Runkus & Royal Blu", 
                "Jemere Morgan", "Kaya Jonkunnu Band", "Walking Tall Jamaica", "Nathan & The Zydeco Cha Chas", "J & The Causeways", 
                "Creole String Beans", "Honey Island Swamp Band", "Jeremy Davenport", "Ghalia Volt", "Lilli Lewis", 
                "Jermaine Landrum & The Abundant Praise Revival Choir", "Mia Borders", "Midnite Disturbers", "Leroy Jones & New Orleans' Finest", 
                "Alexey Marti & Sugarflow", "John Mooney & Bluesiana", "Susan Cowsill", "Savoy Family Cajun Band", 
                "Dustin Dale Gaspard & the Rockin Babines", "Bill Summers & Jazalsa", "Mark Braud's New Orleans Jazz Giants", 
                "Seguenon Kone's Ivoire Spectacle", "Hardhead Hunters Mardi Gras Indians", "Johanna Rose", "Storyville Stompers Brass Band"]
    },
    "Sunday, May 3": {
        tier1: ["Teddy Swims", "Earth, Wind & Fire", "Tedeschi Trucks Band"],
        tier2: ["Herbie Hancock", "Trombone Shorty & Orleans Avenue", "Mavis Staples"],
        tier3: ["Galactic featuring Jelly Joseph", "The Radiators", "Rebirth Brass Band", "Jackie Venson", "Big Sam's Funky Nation", 
                "George Porter Jr & Runnin' Pardners", "Jon Cleary & the Absolute Monster Gentlemen", "Steve Earle featuring Anders Osborne", 
                "Lila Ik√©", "Kevin Downswell", "Jemere Morgan", "Kaya Jonkunnu Band", "Walking Tall Jamaica", 
                "Kermit Ruffins' Tribute to Louis Armstrong", "Deacon John", "Shamarr Allen", "RAM from Haiti", "Lil' Nathan & the Zydeco Big Timers", 
                "Big Chief Bo Dollis Jr. & The Wild Magnolias", "James Andrews & the Crescent City Allstars", "Jason Marsalis", "Andrew Duhon", 
                "Davell Crawford presents Fabulous Friends Forever", "Trumpet Mafia's Tribute to Miles Davis", "Doreen's Jazz New Orleans", 
                "Steve Riley & the Mamou Playboys", "Banu Gibson", "The Allen Toussaint Jazzity Project", "Greg Stafford & His Young Tuxedo Brass Band", 
                "Raphael Bas and Harmonouche", "Herbert McCarver & Pin Stripe Brass Band", "James McClaskey & The Rhythm Band", "BRW", 
                "Mariachi Jalisco", "Original Pinettes Brass Band", "Robin Barnes & the FiyaBirds"]
    }
};

let scheduleData = getDefaultScheduleData();
let editingEvent = null, isAddMode = false, selectedLibraryShow = null;
let currentTab = 'planner', nighttimeFilter = 'all', nighttimeSearch = '';
let jazzfestFilter = 'all', jazzfestSearch = '';

async function loadFromStorage() {
    try {
        // VERSION FLAG - increment this to force a reset with new default data
        const DATA_VERSION = 'v4-clean-rebuild';
        
        const saved = await loadFromFirebase();
        const savedVersion = saved ? saved.__version : null;
        
        if (saved && savedVersion === DATA_VERSION) {
            // Data is current version - load normally
            scheduleData = getDefaultScheduleData();
            Object.keys(saved).forEach(dayKey => {
                if (scheduleData[dayKey] && saved[dayKey]) {
                    Object.keys(saved[dayKey].events || {}).forEach(sectionKey => {
                        if (saved[dayKey].events[sectionKey] && Array.isArray(saved[dayKey].events[sectionKey])) {
                            scheduleData[dayKey].events[sectionKey] = saved[dayKey].events[sectionKey];
                        }
                    });
                }
            });
            console.log('Schedule loaded from Firebase (current version)');
        } else {
            // No data or outdated version - load clean default and save to Firebase
            console.log('Loading clean schedule data and saving to Firebase...');
            scheduleData = getDefaultScheduleData();
            scheduleData.__version = DATA_VERSION;
            await saveToFirebase(scheduleData);
            console.log('Clean schedule saved to Firebase');
        }
    } catch (error) {
        console.log('Error loading, using defaults:', error);
        scheduleData = getDefaultScheduleData();
    }
}

function saveToStorage() {
    try {
        saveToFirebase(scheduleData);
    } catch (error) {
        console.error('Error saving:', error);
    }
}

function switchTab(tab) {
    currentTab = tab;
    document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
    document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
    
    if (tab === 'planner') {
        document.querySelector('[onclick="switchTab(\'planner\')"]').classList.add('active');
        document.getElementById('planner-tab').classList.add('active');
        document.querySelector('.add-show-btn').style.display = 'flex';
        document.querySelector('.add-activity-btn').style.display = 'flex';
        renderSchedule();
    } else if (tab === 'nighttime') {
        document.querySelector('[onclick="switchTab(\'nighttime\')"]').classList.add('active');
        document.getElementById('nighttime-tab').classList.add('active');
        document.querySelector('.add-show-btn').style.display = 'none';
        document.querySelector('.add-activity-btn').style.display = 'none';
        renderNighttimeLibrary();
    } else if (tab === 'jazzfest') {
        document.querySelector('[onclick="switchTab(\'jazzfest\')"]').classList.add('active');
        document.getElementById('jazzfest-tab').classList.add('active');
        document.querySelector('.add-show-btn').style.display = 'none';
        document.querySelector('.add-activity-btn').style.display = 'none';
        renderJazzFestLibrary();
    }
}

function isShowInPlanner(showName) {
    for (const dayKey in scheduleData) {
        for (const section in scheduleData[dayKey].events) {
            if (scheduleData[dayKey].events[section].find(e => 
                e.name.toLowerCase() === showName.toLowerCase()
            )) return true;
        }
    }
    return false;
}

function renderSchedule() {
    const container = document.getElementById('schedule-container');
    container.innerHTML = '';
    Object.keys(scheduleData).forEach(dayKey => {
        const day = scheduleData[dayKey];
        const section = document.createElement('div');
        section.className = 'day-section';
        let html = `<div class="day-header"><div><div class="day-title">${day.day}</div>${day.subtitle ? `<div class="day-subtitle">${day.subtitle}</div>` : ''}</div></div>`;
        const sectionConfig = {
            evening: 'Evening Shows', fest: 'Jazz Fest Highlights',
            postfest: 'Post-Fest Shows', latenight: 'Late Night Shows', other: 'Other Activities'
        };
        ['evening', 'fest', 'postfest', 'latenight', 'other'].forEach(sectionKey => {
            const events = day.events[sectionKey] || [];
            if (events.length > 0) {
                html += `<div class="section-title">${sectionConfig[sectionKey]}</div><div class="cards-grid section-${sectionKey}">`;
                events.forEach(event => html += renderCard(event, dayKey, sectionKey));
                html += `</div>`;
            }
        });
        section.innerHTML = html;
        container.appendChild(section);
    });
}

function renderCard(evt, dayKey, sectionKey) {
    const statusClass = evt.ticketStatus === 'tickets' ? 'has-tickets' : 
                        evt.ticketStatus === 'planning' ? 'planning' : 
                        evt.ticketStatus === 'maybe' ? 'maybe' : '';
    const sizeClass = evt.cardSize ? `size-${evt.cardSize}` : 'size-medium';
    const sectionClass = sectionKey ? `card-${sectionKey}` : '';
    let badge = evt.ticketStatus === 'tickets' ? '<span class="card-badge tickets">‚úì Have Tickets</span>' : 
                evt.ticketStatus === 'planning' ? '<span class="card-badge planning">Planning to Go</span>' :
                evt.ticketStatus === 'maybe' ? '<span class="card-badge maybe">Maybe</span>' : '';
    let timeInfo = '';
    if (evt.doorTime && evt.showTime) {
        timeInfo = `<div class="time-group"><div class="card-detail-row">üö™ Doors: ${evt.doorTime}</div><div class="card-detail-row">üïê Show: ${evt.showTime}</div></div>`;
    } else if (evt.showTime) {
        timeInfo = `<div class="card-detail-row">üïê ${evt.showTime}</div>`;
    }
    return `<div class="card ${statusClass} ${sizeClass} ${sectionClass}" onclick="if(!event.target.classList.contains('delete-btn')) openEditModal('${dayKey}', '${evt.id}')">
        <div class="card-header"><div class="card-name">${evt.name}</div>
        <button class="delete-btn" data-day="${dayKey}" data-id="${evt.id}">√ó</button></div>
        <div class="card-details">${evt.venue ? `<div class="card-detail-row">üìç ${evt.venue}</div>` : ''}${timeInfo}</div>
        ${evt.notes ? `<div class="card-notes">${evt.notes}</div>` : ''}${badge}</div>`;
}

function renderNighttimeLibrary() {
    const container = document.getElementById('nighttime-container');
    const filtersContainer = document.getElementById('nighttime-filters');
    if (filtersContainer.children.length === 0) {
        ['all', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday'].forEach(day => {
            const btn = document.createElement('button');
            btn.className = `filter-btn ${day === 'all' ? 'active' : ''}`;
            btn.textContent = day.charAt(0).toUpperCase() + day.slice(1);
            btn.onclick = () => {
                document.querySelectorAll('#nighttime-filters .filter-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                nighttimeFilter = day;
                renderNighttimeLibrary();
            };
            filtersContainer.appendChild(btn);
        });
    }
    container.innerHTML = '';
    let hasResults = false;
    Object.keys(nighttimeLibrary).forEach(venueName => {
        const venue = nighttimeLibrary[venueName];
        let filteredShows = venue.shows.filter(show => {
            const matchesDay = nighttimeFilter === 'all' || show.day === nighttimeFilter;
            const matchesSearch = !nighttimeSearch || show.name.toLowerCase().includes(nighttimeSearch) ||
                venueName.toLowerCase().includes(nighttimeSearch) || (show.notes && show.notes.toLowerCase().includes(nighttimeSearch));
            return matchesDay && matchesSearch;
        });
        if (filteredShows.length === 0) return;
        hasResults = true;
        const section = document.createElement('div');
        section.className = 'venue-section';
        let html = `<div class="venue-header"><div><div class="venue-name">${venueName}</div><div class="venue-address">${venue.address}</div></div></div><div class="shows-grid">`;
        filteredShows.forEach((show, idx) => {
            const inPlanner = isShowInPlanner(show.name);
            let timeInfo = '';
            if (show.doorTime && show.showTime) {
                timeInfo = `<div class="time-group"><div class="show-detail-row">üö™ Doors: ${show.doorTime}</div><div class="show-detail-row">üïê Show: ${show.showTime}</div></div>`;
            } else if (show.showTime) {
                timeInfo = `<div class="show-detail-row">üïê ${show.showTime}</div>`;
            }
            const safeVenue = encodeURIComponent(venueName);
            const safeName = encodeURIComponent(show.name);
            html += `<div class="show-card ${inPlanner ? 'in-planner' : ''}" 
                data-venue="${safeVenue}" data-idx="${idx}" data-name="${safeName}" data-inplanner="${inPlanner}"
                onclick="handleNighttimeCardClick(this, event)" style="cursor: pointer;">
                <div class="show-header"><div class="show-name">${show.name}</div>
                <button class="add-btn ${inPlanner ? 'added' : ''}" 
                    data-venue="${safeVenue}" data-idx="${idx}" data-name="${safeName}" data-inplanner="${inPlanner}"
                    onclick="event.stopPropagation(); handleNighttimeAddClick(this)">${inPlanner ? '‚úì' : '+'}</button></div>
                <div class="show-details">${timeInfo}</div>${show.notes ? `<div class="show-notes">${show.notes}</div>` : ''}
                <span class="show-day">${show.day}</span></div>`;
        });
        html += '</div>';
        section.innerHTML = html;
        container.appendChild(section);
    });
    if (!hasResults) container.innerHTML = '<div class="no-results">No shows found.</div>';
}

function renderJazzFestLibrary() {
    const container = document.getElementById('jazzfest-container');
    const filtersContainer = document.getElementById('jazzfest-filters');
    if (filtersContainer.children.length === 0) {
        ['all', 'thursday', 'friday', 'saturday', 'sunday'].forEach(day => {
            const btn = document.createElement('button');
            btn.className = `filter-btn ${day === 'all' ? 'active' : ''}`;
            btn.textContent = day === 'all' ? 'All Days' : day.charAt(0).toUpperCase() + day.slice(1);
            btn.onclick = () => {
                document.querySelectorAll('#jazzfest-filters .filter-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                jazzfestFilter = day;
                renderJazzFestLibrary();
            };
            filtersContainer.appendChild(btn);
        });
    }
    container.innerHTML = '';
    let hasResults = false;
    Object.keys(jazzFestLibrary).forEach(dayName => {
        const dayKey = dayName.toLowerCase().includes('thursday') ? 'thursday' :
                      dayName.toLowerCase().includes('friday') ? 'friday' :
                      dayName.toLowerCase().includes('saturday') ? 'saturday' : 'sunday';
        if (jazzfestFilter !== 'all' && jazzfestFilter !== dayKey) return;
        
        const dayData = jazzFestLibrary[dayName];
        let allArtists = [];
        
        // If searching, collect all artists and filter, showing at full size
        if (jazzfestSearch) {
            ['tier1', 'tier2', 'tier3'].forEach(tier => {
                dayData[tier].forEach(artist => {
                    if (artist.toLowerCase().includes(jazzfestSearch)) {
                        allArtists.push({ name: artist, tier: 'tier1', searchResult: true });
                    }
                });
            });
            if (allArtists.length === 0) return;
        } else {
            // No search - show with hierarchy
            dayData.tier1.forEach(artist => allArtists.push({ name: artist, tier: 'tier1' }));
            dayData.tier2.forEach(artist => allArtists.push({ name: artist, tier: 'tier2' }));
            dayData.tier3.forEach(artist => allArtists.push({ name: artist, tier: 'tier3' }));
        }
        
        hasResults = true;
        const section = document.createElement('div');
        section.className = 'venue-section';
        let html = `<div class="venue-header"><div><div class="venue-name">${dayName}</div><div class="venue-address">Fair Grounds</div></div></div><div class="jazzfest-pills">`;
        
        allArtists.forEach((artistData, idx) => {
            const inPlanner = isShowInPlanner(artistData.name);
            const tierClass = artistData.searchResult ? 'tier1' : artistData.tier;
            html += `<div class="show-card show-card-jazzfest ${tierClass} ${inPlanner ? 'in-planner' : ''}" onclick="event.target.classList.contains('add-btn') || ${inPlanner ? `removeFromPlannerConfirm('${artistData.name}')` : `openLibraryAddModal('${dayName}', '${artistData.name}', 'jazzfest', '${artistData.tier}')`}" style="cursor: pointer;">
                <div class="show-header"><div class="show-name">${artistData.name}</div>
                <button class="add-btn ${inPlanner ? 'added' : ''}" onclick="event.stopPropagation(); ${inPlanner ? `removeFromPlannerConfirm('${artistData.name}')` : `openLibraryAddModal('${dayName}', '${artistData.name}', 'jazzfest', '${artistData.tier}')`}">${inPlanner ? '‚úì' : '+'}</button></div></div>`;
        });
        
        html += '</div>';
        section.innerHTML = html;
        container.appendChild(section);
    });
    if (!hasResults) container.innerHTML = '<div class="no-results">No artists found.</div>';
}

function openAddModal() {
    isAddMode = true; editingEvent = null;
    document.getElementById('modal-title').textContent = 'Add Show';
    document.getElementById('edit-section').value = 'fest';
    document.getElementById('edit-day').value = 'wednesday';
    ['edit-name', 'edit-venue', 'edit-door-time', 'edit-show-time', 'edit-notes'].forEach(id => document.getElementById(id).value = '');
    document.getElementById('edit-ticket-status').value = 'none';
    document.getElementById('edit-card-size').value = 'medium';
    document.getElementById('edit-modal').classList.add('active');
}

function openAddActivityModal() {
    isAddMode = true; editingEvent = null;
    document.getElementById('modal-title').textContent = 'Add Activity';
    document.getElementById('edit-section').value = 'other';
    document.getElementById('edit-day').value = 'wednesday';
    ['edit-name', 'edit-venue', 'edit-door-time', 'edit-show-time', 'edit-notes'].forEach(id => document.getElementById(id).value = '');
    document.getElementById('edit-ticket-status').value = 'none';
    document.getElementById('edit-card-size').value = 'small';
    document.getElementById('edit-modal').classList.add('active');
}

function openEditModal(dayKey, eventId) {
    isAddMode = false;
    const day = scheduleData[dayKey];
    let foundEvent = null, foundSection = null;
    Object.keys(day.events).forEach(section => {
        const evt = day.events[section].find(e => e.id === eventId);
        if (evt) { foundEvent = evt; foundSection = section; }
    });
    if (!foundEvent) return;
    editingEvent = { dayKey, eventId, section: foundSection };
    document.getElementById('modal-title').textContent = 'Edit Event';
    document.getElementById('edit-section').value = foundSection;
    document.getElementById('edit-day').value = dayKey;
    document.getElementById('edit-name').value = foundEvent.name;
    document.getElementById('edit-venue').value = foundEvent.venue || '';
    document.getElementById('edit-door-time').value = foundEvent.doorTime || '';
    document.getElementById('edit-show-time').value = foundEvent.showTime || '';
    document.getElementById('edit-ticket-status').value = foundEvent.ticketStatus || 'none';
    document.getElementById('edit-card-size').value = foundEvent.cardSize || 'medium';
    document.getElementById('edit-notes').value = foundEvent.notes || '';
    document.getElementById('edit-modal').classList.add('active');
}

function closeModal() {
    document.getElementById('edit-modal').classList.remove('active');
    editingEvent = null; isAddMode = false;
}

function saveEvent() {
    const section = document.getElementById('edit-section').value;
    const dayKey = document.getElementById('edit-day').value;
    const name = document.getElementById('edit-name').value.trim();
    if (!name) { alert('Please enter a name'); return; }
    const eventData = {
        id: isAddMode ? `${dayKey}-${Date.now()}` : editingEvent.eventId,
        name, venue: document.getElementById('edit-venue').value.trim(),
        doorTime: document.getElementById('edit-door-time').value.trim(),
        showTime: document.getElementById('edit-show-time').value.trim(),
        ticketStatus: document.getElementById('edit-ticket-status').value,
        cardSize: document.getElementById('edit-card-size').value,
        notes: document.getElementById('edit-notes').value.trim()
    };
    if (isAddMode) {
        if (!scheduleData[dayKey].events[section]) scheduleData[dayKey].events[section] = [];
        scheduleData[dayKey].events[section].push(eventData);
    } else {
        const oldDay = scheduleData[editingEvent.dayKey];
        const oldIdx = oldDay.events[editingEvent.section].findIndex(e => e.id === editingEvent.eventId);
        if (oldIdx !== -1) oldDay.events[editingEvent.section].splice(oldIdx, 1);
        if (!scheduleData[dayKey].events[section]) scheduleData[dayKey].events[section] = [];
        scheduleData[dayKey].events[section].push(eventData);
    }
    closeModal();
    renderSchedule();
    saveToStorage();
}

function deleteEvent(dayKey, eventId) {
    console.log('DELETE FUNCTION CALLED:', dayKey, eventId);
    // Removed confirmation - delete immediately
    Object.keys(scheduleData[dayKey].events).forEach(section => {
        const idx = scheduleData[dayKey].events[section].findIndex(evt => evt.id === eventId);
        if (idx !== -1) {
            console.log('Found event in section:', section, 'at index:', idx);
            scheduleData[dayKey].events[section].splice(idx, 1);
        }
    });
    saveToStorage();
    console.log('Rendering schedule after delete');
    renderSchedule();
}

// Add event delegation for delete buttons with capturing
console.log('Setting up delete button event listener');
document.addEventListener('click', function(e) {
    console.log('Document click:', e.target.tagName, e.target.className);
    if (e.target && e.target.classList && e.target.classList.contains('delete-btn')) {
        console.log('DELETE BUTTON CLICKED!');
        e.stopPropagation();
        e.preventDefault();
        const dayKey = e.target.getAttribute('data-day');
        const eventId = e.target.getAttribute('data-id');
        console.log('Day:', dayKey, 'ID:', eventId);
        if (dayKey && eventId) {
            deleteEvent(dayKey, eventId);
        } else {
            console.log('Missing data attributes!');
        }
    }
}, true);

function handleNighttimeCardClick(el, event) {
    if (event.target.classList.contains('add-btn')) return;
    const inPlanner = el.dataset.inplanner === 'true';
    const name = decodeURIComponent(el.dataset.name);
    const venue = decodeURIComponent(el.dataset.venue);
    const idx = parseInt(el.dataset.idx);
    if (inPlanner) {
        removeFromPlannerConfirm(name);
    } else {
        openLibraryAddModal(venue, idx, 'nighttime');
    }
}

function handleNighttimeAddClick(btn) {
    const inPlanner = btn.dataset.inplanner === 'true';
    const name = decodeURIComponent(btn.dataset.name);
    const venue = decodeURIComponent(btn.dataset.venue);
    const idx = parseInt(btn.dataset.idx);
    if (inPlanner) {
        removeFromPlannerConfirm(name);
    } else {
        openLibraryAddModal(venue, idx, 'nighttime');
    }
}

function openLibraryAddModal(source, indexOrName, type, tier) {
    let show;
    if (type === 'nighttime') {
        const venue = nighttimeLibrary[source];
        show = venue.shows[indexOrName]; // indexOrName is index for nighttime
        if (isShowInPlanner(show.name)) return;
        selectedLibraryShow = {
            name: show.name, venue: `${source} (${venue.address})`,
            doorTime: show.doorTime, showTime: show.showTime,
            notes: show.notes, suggestedDay: show.day, cardSize: 'medium'
        };
        document.getElementById('library-day').value = show.day;
        document.getElementById('library-section').value = (show.showTime && (show.showTime.includes('am') || parseInt(show.showTime) >= 12)) ? 'latenight' : 'postfest';
    } else {
        const artist = indexOrName; // indexOrName is artist name for jazzfest
        if (isShowInPlanner(artist)) return;
        const dayKey = source.toLowerCase().includes('thursday') ? 'thursday' :
                      source.toLowerCase().includes('friday') ? 'friday' :
                      source.toLowerCase().includes('saturday') ? 'saturday' : 'sunday';
        // Map tier to card size: tier1 -> large, tier2 -> medium, tier3 -> small
        const cardSize = tier === 'tier1' ? 'large' : tier === 'tier2' ? 'medium' : 'small';
        selectedLibraryShow = { name: artist, venue: "Fair Grounds", doorTime: "", showTime: "", notes: "", suggestedDay: dayKey, cardSize: cardSize };
        document.getElementById('library-day').value = dayKey;
        document.getElementById('library-section').value = 'fest';
    }
    document.getElementById('add-from-library-modal').classList.add('active');
}

function closeLibraryModal() {
    document.getElementById('add-from-library-modal').classList.remove('active');
    selectedLibraryShow = null;
}

function showConfirm(message, title = 'Confirm') {
    return new Promise((resolve) => {
        const modal = document.getElementById('confirm-modal');
        const titleEl = document.getElementById('confirm-title');
        const messageEl = document.getElementById('confirm-message');
        const yesBtn = document.getElementById('confirm-yes');
        const noBtn = document.getElementById('confirm-no');
        
        titleEl.textContent = title;
        messageEl.textContent = message;
        modal.classList.add('active');
        
        const handleYes = () => {
            modal.classList.remove('active');
            yesBtn.removeEventListener('click', handleYes);
            noBtn.removeEventListener('click', handleNo);
            resolve(true);
        };
        
        const handleNo = () => {
            modal.classList.remove('active');
            yesBtn.removeEventListener('click', handleYes);
            noBtn.removeEventListener('click', handleNo);
            resolve(false);
        };
        
        yesBtn.addEventListener('click', handleYes);
        noBtn.addEventListener('click', handleNo);
    });
}

async function removeFromPlannerConfirm(showName) {
    const confirmed = await showConfirm(`Remove "${showName}" from your planner?`, 'Remove Show');
    if (confirmed) {
        // Find and remove the show from all days/sections
        let removed = false;
        Object.keys(scheduleData).forEach(dayKey => {
            Object.keys(scheduleData[dayKey].events).forEach(sectionKey => {
                const events = scheduleData[dayKey].events[sectionKey];
                const index = events.findIndex(e => 
                    e.name.toLowerCase() === showName.toLowerCase()
                );
                if (index !== -1) {
                    events.splice(index, 1);
                    removed = true;
                }
            });
        });
        
        if (removed) {
            saveToStorage();
            // Re-render current view
            if (currentTab === 'nighttime') renderNighttimeLibrary();
            else if (currentTab === 'jazzfest') renderJazzFestLibrary();
            else if (currentTab === 'planner') renderSchedule();
        }
    }
}

function confirmLibraryAdd() {
    if (!selectedLibraryShow) return;
    const day = document.getElementById('library-day').value;
    const section = document.getElementById('library-section').value;
    const newEvent = {
        id: `${day}-${Date.now()}`, name: selectedLibraryShow.name,
        venue: selectedLibraryShow.venue, doorTime: selectedLibraryShow.doorTime,
        showTime: selectedLibraryShow.showTime, ticketStatus: 'none',
        cardSize: selectedLibraryShow.cardSize || 'medium',
        notes: selectedLibraryShow.notes
    };
    if (!scheduleData[day].events[section]) scheduleData[day].events[section] = [];
    scheduleData[day].events[section].push(newEvent);
    closeLibraryModal();
    if (currentTab === 'nighttime') renderNighttimeLibrary();
    else if (currentTab === 'jazzfest') renderJazzFestLibrary();
    saveToStorage();
}

document.getElementById('edit-modal').addEventListener('click', e => { if (e.target === document.getElementById('edit-modal')) closeModal(); });
document.getElementById('add-from-library-modal').addEventListener('click', e => { if (e.target === document.getElementById('add-from-library-modal')) closeLibraryModal(); });

// Nighttime search with clear button
const nighttimeSearchInput = document.getElementById('nighttime-search');
const nighttimeSearchClear = document.getElementById('nighttime-search-clear');
nighttimeSearchInput.addEventListener('input', e => {
    nighttimeSearch = e.target.value.toLowerCase();
    nighttimeSearchClear.style.display = nighttimeSearch ? 'flex' : 'none';
    renderNighttimeLibrary();
});
nighttimeSearchClear.addEventListener('click', () => {
    nighttimeSearchInput.value = '';
    nighttimeSearch = '';
    nighttimeSearchClear.style.display = 'none';
    renderNighttimeLibrary();
});

// Jazz fest search with clear button
const jazzfestSearchInput = document.getElementById('jazzfest-search');
const jazzfestSearchClear = document.getElementById('jazzfest-search-clear');
jazzfestSearchInput.addEventListener('input', e => {
    jazzfestSearch = e.target.value.toLowerCase();
    jazzfestSearchClear.style.display = jazzfestSearch ? 'flex' : 'none';
    renderJazzFestLibrary();
});
jazzfestSearchClear.addEventListener('click', () => {
    jazzfestSearchInput.value = '';
    jazzfestSearch = '';
    jazzfestSearchClear.style.display = 'none';
    renderJazzFestLibrary();
});

async function init() {
    await loadFromStorage();
    renderSchedule();
    
    // Setup real-time Firebase listener
    subscribeToUpdates((newData) => {
        scheduleData = getDefaultScheduleData();
        Object.keys(newData).forEach(dayKey => {
            if (scheduleData[dayKey]) {
                Object.keys(newData[dayKey].events).forEach(sectionKey => {
                    if (newData[dayKey].events[sectionKey] && Array.isArray(newData[dayKey].events[sectionKey])) {
                        scheduleData[dayKey].events[sectionKey] = newData[dayKey].events[sectionKey];
                    }
                });
            }
        });
        renderSchedule();
    });
    
    // Display share URL info
}

init();
    </script>
</body>
</html>
